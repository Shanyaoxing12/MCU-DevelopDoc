# **UG103.2: Zigbee Fundamentals** <!-- omit in toc -->

本文档介绍了 Zigbee 解决方案的主要特点和特性。它还包括一个 Zigbee 3.0 的章节。

Silicon Labs 的应用程序开发基本原理系列涵盖了项目经理，应用程序设计人员和开发人员在开始使用 Silicon Labs 芯片，EmberZNet PRO 或 Silicon Labs Bluetooth® 等网络协议栈以及相关开发工具的嵌入式网络解决方案之前应该了解的主题。这些文档可以作为任何需要介绍开发无线网络应用程序的人或者是 Silicon Labs 开发环境的新手的起点。

关键点:
* 介绍 Zigbee 和关键特点 - 网状网络，网络节点类型，路由概念，Zigbee 协议栈，Zigbee Cluster Library 和 Zigbee 合规性
* 包括一个 Zigbee 3.0 的章节

------------------------------------------------------------------------------------------------------------------------

- [**1. 引言**](#1-引言)
    - [**1.1 一般特征**](#11-一般特征)
    - [**1.2 IEEE 802.15.4**](#12-ieee-802154)
    - [**1.3 硬件和软件元素**](#13-硬件和软件元素)
        - [**1.3.1 关于应用程序框架**](#131-关于应用程序框架)
        - [**1.3.2 其他工具和实用程序**](#132-其他工具和实用程序)

------------------------------------------------------------------------------------------------------------------------

# **1. 引言**

Zigbee 指的是：
* 一个可靠、经济、低功耗、无线设备间通信的开放标准。
* 一个由 400 多家公司组成的联盟，他们共同定义并使用该标准以在各种应用程序中进行通信，如智能能源和商业楼宇自动化。

ZigBee 联盟由一帮组成董事会的发起人成员公司领导。Silicon Labs 是董事会成员之一。Zigbee 还拥有大量参与者和采用者成员，他们在技术和营销工作组内工作，以创建和维护标准。联盟的活动是通过致力于该技术特定领域的工作组完成的。这些包括网络组，安全组，应用程序配置文件组和其他几个组。所有 Zigbee 文档都可以在 Zigbee 网站 [www.zigbee.org](https://www.zigbee.org/) 上找到。需要 Zigbee Alliance 会员才能访问当前的规范文档。要在产品中使用 Zigbee 技术，公司必须成为联盟的成员。

Silicon Labs 活跃于联盟的各个领域，并通过其 Ember® Zigbee 解决方案帮助客户采用 Zigbee 技术。Ember Zigbee 平台是迄今为止所有新标准的测试和认证的参考平台。Ember 公司于2012年7月被 Silicon Labs 收购，是 Zigbee 联盟的创始成员。

Zigbee 联盟提到了三个主要的关心的项。
1. Zigbee 网络 - 网络交互的基本标准，包括可接受的 RF 行为，创建和加入网络的方法，发现路由以及使用路由通过网络传输流量。Zigbee 联盟提供其他网络规范，如 RF4CE 和 GreenPower，但本文档的重点是 Zigbee PRO。
2. Zigbee 应用层 - 描述 Zigbee 应用程序的一组消息和网络设置。遵守这些设置的所有设备都可以互操作。在 Zigbee 3.0 之前，个人应用程序配置文件，无论是公共的还是私有的，都有自己的认证程序。Zigbee 3.0 是一个通用的应用层认证程序，适用于所有 Zigbee 产品。下图展示了一些原始的独立 Zigbee 应用程序配置文件。
    
    ![Figure 1.1. Zigbee Application Profiles](../Pic/Zigbee%20Fundamentals-F1.1.jpg)

3. 认证 - Zigbee 应用程序经联盟认证，以向最终用户表明该设备是合规的。使用私有配置文件的应用程序将获得认证，证明其正在使用正确操作的 Zigbee 协议栈，并且在运行期间不会对其他 Zigbee 网络产生负面影响。详情请参阅 [7. Zigbee 合规性]()。

由于 Zigbee 致力于开放和可互操作的设备，因此它们存在或开发的地方都采用了标准，从物理层到应用层，如下图所示。在物理层和 MAC（介质访问控制）层，Zigbee 采用 IEEE 802.15.4 标准。网络，安全和应用层都是由 Zigbee 联盟开发的。其还开发了一个由网关和调试工具等支持系统组成的生态系统，以简化 Zigbee 网络的开发和部署。标准的扩展和附件还在继续开发中，Silicon Labs 致力于支持这些标准。

![Figure 1.2. Zigbee Architecture](../Pic/Zigbee%20Fundamentals-F1.2.jpg)

后面三个小节描述了 Zigbee 网络的一般特征，讨论了 IEEE 802.15.4 标准的使用，并总结了 Zigbee 网络的硬件和软件元素。

## **1.1 一般特征**

Zigbee 旨在成为一种经济高效的低功耗解决方案。它面向多个市场，包括家庭自动化，楼宇自动化，传感器网络，智能能源和个人健康护理监测。Zigbee 网络的一般特征如下：
* 低功耗 - 设备通常可以使用合适的工作周期在 AA 型电池上运行数年。通过极其谨慎的设计和特殊的电池技术，一些 Zigbee 设备（如燃气表）可以达到 20 年的电池寿命。
* 低数据速率 - 2.4 GHz 频段下支持 250 kbps 的无线数据速率。网络中的实际持续流量速率低于理论值。因此，Zigbee 更适用于采样和监控应用或基本控制应用。请参见 [AN1138: Zigbee Mesh Network Performance]() 和 [AN1142: Mesh Network Performance Comparison]()。
* 小型和大型网络 - Zigbee 网络从几个设备到数千个无缝通信的设备不等。网络层设计有多种不同的数据传输机制（路由类型），以根据预期用途优化网络操作。
* 范围 - 典型的设备提供足够的范围来覆盖普通家庭。易用的功率放大器设计大幅度地扩展了范围。在物理层上使用分布式扩频，以更好地抵抗干扰。
* 简单的网络安装、启动和操作 - Zigbee 标准支持多种网络拓扑。用于形成和加入网络的简单协议允许系统在发生路由问题时自行配置和修复。

## **1.2 IEEE 802.15.4**

Zigbee 网络基于 IEEE 802.15.4 MAC 层和物理层。802.15.4 标准在 2.4 GHz 频段下以 250 kbps 运行，在 900/868 MHz 频段下以 40 kbps/20 kbps 运行。许多芯片公司提供 2.4 GHz 频段下的解决方案，其中少数支持 900/868 MHz 频段。Zigbee PRO 使用 802.15.4-2003。

802.15.4 MAC 层用于基本消息处理和拥塞控制。该 MAC 层包括形成和加入网络的机制、用于监听空闲信道的设备的 CSMA 机制，以及用于相邻设备间可靠通信的重试处理和消息确认的链路层。Zigbee 网络层建立在这些底层机制之上，以在网络中提供可靠的端到端通信。802.15.4 标准可从 [www.ieee.org](https://www.ieee.org/) 中下载。

802.15.4 标准在 MAC 层中提供了 Zigbee 在任何当前协议栈配置文件中都未使用的一些选项。这种未使用的特点的一个例子是保证时隙（GTS），其将被网络用于跨设备同步无线电活动。因此，这些项通常不包含在 Zigbee 软件协议栈中以节省代码空间。Zigbee 还对 Zigbee 规范附录 D 中记录的 802.15.4 MAC 进行了具体更改。

## **1.3 硬件和软件元素**

Zigbee 解决方案需要实现 Zigbee 无线电和相关的微处理器（在单个芯片中或单独的），并在 Zigbee 协议栈之上实现应用程序。EmberZNet PRO 是 Silicon Labs 的 Zigbee PRO 协议栈实现。

典型地，开发人员可以购买 Zigbee 无线电和软件作为捆绑包，尽管已经有一些第三方软件协议栈。通常，硬件和软件供应商提供包括用于软件的示例应用和硬件的参考设计。基于这些，硬件开发人员可以根据自己的特定需求定制硬件。或者，许多模块提供商可以提供紧凑且低成本的定制模块。

由于典型 Zigbee 应用程序的嵌入特性，软件应用程序开发通常与硬件设计相互关联，以提供最佳解决方案。Silicon Labs 提供基于 Zigbee 规范的标准网络 API 和应用程序框架，其为客户提供一种基于 Zigbee 应用程序配置文件和 Zigbee 簇库（ZCL）的快速开发应用程序方法，如下所述。另外，许多第三方软件开发公司专门开发 Zigbee 应用程序，并可以协助新产品开发。

### **1.3.1 关于应用程序框架**

任何应用程序都可以从头开始构建，但这是一个缓慢且冗长的过程。另一种方法是获取工作代码并对其进行修改以满足应用程序的要求。适应工作设计是构建应用程序的一种更简单，更有效的方法，尤其是使用新技术的第一个应用程序。为了解决这个问题，Silicon Labs 不仅提供示例应用程序代码，还提供一个或多个应用程序框架作为其开发平台的一部分。应用程序框架包含存储在库和插件中的 Silicon Labs 提供的代码体，Silicon Labs 还提供 Simplicity Studio，其中包括基于 Application Builder（AppBuilder）的集成开发环境（IDE）。AppBuilder 是一个交互式GUI工具，允许您配置应用程序框架中包含的库和插件，以在应用程序配置文件中实现设备，如 ZigBee Smart Energy 仪表。

应用程序框架目前有两种样式或版本（version 2 and version 6）。该版本确定已安装的目录结构，可用的元数据以及某些功能是硬编码还是通过插件可用。这两个版本之间的差异在 **UG102: Application Framework User Guide** 中详细地描述。 EmberZNet PRO 协议栈包括两个版本的应用程序框架。Zigbee PRO 应用程序框架，也称为 ZCL Application Framework V2，是一个 version 2 框架，通常称为 AFV2。网络协处理器应用程序框架也随 EmberZNet PRO 协议栈一起提供，其使用 version 6 开发。

AFV2 基于 ZCL（ZigBee 簇库），用于开发 ZigBee PRO 应用程序。它提供了一组嵌入式代码，用于实现 ZCL-based cluster 处理、所需的网络任务和典型的 ZigBee 应用程序状态机，并包括对 Zigbee 3.0 应用程序层的支持，以及许多遗留的 Zigbee 配置文件（例如 Home Automation（HA），Smart Energy（SE）和 Zigbee Light Link（ZLL））。此代码是根据 Silicon Labs 推荐的最佳实践和不同 ZigBee 应用程序配置文件的规范开发的，可作为一种 “软件参考设计”，可在片上系统（如 EFR32）上运行或者在主机处理器上连接到基于 EZSP（EmberZNet 串行协议）的网络控制处理器。

Silicon Labs 正致力于将这两个版本协调为一个框架版本。与此同时，无论它们是在 v2 还是 v6 下开发的，应用程序框架都提供了通用的基本服务，并且当与特定于设备的代码结合使用时，可为您提供设备的大部分的无线行为。然后，您的任务就是开发特定于硬件的功能，并将其与 Silicon Labs 软件连接起来。每个 Silicon Labs 协议栈版本都提供了一些基于相关应用程序框架的常见用例示例。

使用应用程序框架有以下好处：
* 帮助维护一个通用方法，并遵守协议标准和 Silicon Labs 最佳实践。
* 帮助确保协议合规性，因为 Silicon Labs 通过预合规性测试运行应用程序框架。
* 允许简易地合并更新，因为 Silicon Labs 维护核心组件。
* 提供在应用程序中包含复杂任务的能力，而无需在代码级别管理这些任务。
* 提供可配置性，同时维护协议合规性以及简易地更新到未来协议栈版本的能力。
* 提供一个 回调/命令 接口和一组配置点，这些配置点通常更远离协议栈，因此与协议栈级行为相比更符合应用层行为。
* 提供一组插件来说明更高级应用程序逻辑的 “最佳实践” 实现，例如调试功能和 CLI 功能、ZCL 簇实现、应用程序状态机或复杂功能。

所有这些都有助于加快产品上市速度和更强大的解决方案。

### **1.3.2 其他工具和实用程序**

除了 Simplicity Studio 和 AppBuilder，Silicon Labs 还提供了许多在开发过程中可供开发人员使用的实用程序和工具，包括：
* Over-the-air（OTA）bootloaders，允许在部署后升级系统软件
* 网关接口，以将 Zigbee 网络连接到其他系统
* 微处理器的编程工具
* 网络嗅探器和调试工具，允许查看和分析网络操作
* 与领先公司合作的处理器调试工具

